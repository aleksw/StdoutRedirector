#Redirect current process's stdout to one Control widget.

## Problems
* [Windows]Can't capture the stdout output generated by another dlls.

If the dll compiled with a c/c++ run-time which is different from the run-time used by current application, or the run-time staticly linked to the dll or application, we will encounter this problem.

The reason is that, the DLL grabs the stdout handles when it is loaded, which  took place before we changed the stdout handles. Dynamically load the DLL after changing the stdout handles will be helpful in this case.

* [Windows]Can't capture the output of qDebug()

When the application build as a GUI application(without CONFIG += console in the .pro file), the debug messages will be send to the Debuger using the system api OutputDebugString().

```
OutputDebugString(reinterpret_cast<const wchar_t *>(logMessage.utf16()));
```

If ```CONFIG+=console``` is added to the .pro file, the debug message will be sent to the stderr.

```
fprintf(stderr, "%s", logMessage.toLocal8Bit().constData());
```

## Implementation

### Windows
* Normally, we need to create pipe with CreatePipe(), then attach stdout to it's write end with SetStdHandle(), then read from pipe's read end with ReadFile().

* But the CRT has already completed initialization before the application gets a chance to call SetStdHandle(); the three low I/O handles 0, 1, and 2 have already been set up to use the original OS handles. So we must deal with this layer using posix api _dup2() too.

* Anonymous pipes created with CreatePipe() do not support asynchronous I/O, so named pipe is used.

### Posix

## Reference

* [INFO: Calling CRT Output Routines from a GUI Application ](http://support.microsoft.com/kb/q105305)
* [Redirecting standard I/O from within a program](http://homepage.ntlworld.com./jonathan.deboynepollard/FGA/redirecting-standard-io.html)
* [Adding Console I/O to a Win32 GUI App](http://www.halcyon.com/~ast/dload/guicon.htm)
* [Will loading a DLL dynamically reconcile its stderr to a main application? If so, then howâ€¦?](http://stackoverflow.com/questions/3202654/will-loading-a-dll-dynamically-reconcile-its-stderr-to-a-main-application-if-so)
* [How to redirect printf output back into code?](http://stackoverflow.com/questions/5911147/how-to-redirect-printf-output-back-into-code)
* [Is SetStdHandle(STD_OUTPUT_HANDLE, ..) broken under windows 7 ?? ](http://social.msdn.microsoft.com/Forums/vstudio/en-US/a111b4c6-c491-4586-8fcb-2ad67bfbbae8/is-setstdhandlestdoutputhandle-broken-under-windows-7-)
* [Redirect stderr/stdout to a file using SetStdHandle](http://www.adras.com/Redirect-stderr-stdout-to-a-file-using-SetStdHandle.t8132-144.html)
* [Converting a FILE* to a HANDLE ?](http://fixunix.com/programmer/95541-converting-file*-handle.html)
* [How to capture stdout and redirect it to the gui?](http://lists.qt.nokia.com/public/qt-interest/2011-January/030998.html)

